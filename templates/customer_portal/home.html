{% extends 'customer_portal/base.html' %}
{% load static %}

{% block title %}Customer Portal - Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/common.css' %}">
<link rel="stylesheet" href="{% static 'css/customer_portal/home.css' %}">
{% endblock %}

{% block content %}
    <div class="container-fluid home-background py-4">

        <div class="welcome-section">
        
        <div class="logo-container">
            <img src="{% static 'images/SVD1.png' %}" alt="SVD Logo">
        </div>

        <h2>Welcome back, {{ user.name }}! 👋</h2>
        <p>Manage your orders, track your account, and stay updated with SVD Agencies</p>

    </div>
    <br>
    <!-- Messages -->
    {% if messages %}
    <div class="row justify-content-center mb-4">
        <div class="col-lg-6 col-md-8 col-12">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Stats Cards -->
    <div class="row g-3 mb-4">

        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
            <div class="card stats-card h-100 border-danger">
                <div class="card-body d-flex align-items-center">
                    <div class="stats-icon bg-danger-subtle text-danger">
                        <i class="bi bi-exclamation-circle"></i>
                    </div>
                    <div class="ms-3">
                        <h6 class="fw-semibold mb-1">Outstanding Due</h6>

                        {% if user.due > 0 %}
                            <h5 class="mb-0 text-danger">
                                ₹{{ user.due|floatformat:2 }}
                            </h5>
                        {% else %}
                            <h5 class="mb-0 text-muted">₹0.00</h5>
                        {% endif %}

                        <small class="text-muted">Amount payable</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
            <div class="card stats-card h-100 border-success">
                <div class="card-body d-flex align-items-center">
                    <div class="stats-icon bg-success-subtle text-success">
                        <i class="bi bi-wallet2"></i>
                    </div>
                    <div class="ms-3">
                        <h6 class="fw-semibold mb-1">Wallet Balance</h6>

                        {% if user.due < 0 %}
                            <h5 class="mb-0 text-success">
                                ₹{{ user.due|floatformat:2|slice:"1:" }}
                            </h5>
                        {% else %}
                            <h5 class="mb-0 text-muted">₹0.00</h5>
                        {% endif %}

                        <small class="text-muted">Available credit</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
            <div class="card stats-card stats-card-2 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="stats-icon bg-success-subtle text-success"><i class="bi bi-shop"></i></div>
                    <div class="ms-3">
                        <h6 class="fw-semibold mb-1">Shop Name</h6>
                        <h5 class="mb-0">{{ user.shop_name|default:"NA" }}</h5>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
            <div class="card stats-card stats-card-3 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="stats-icon bg-warning-subtle text-warning"><i class="bi bi-telephone"></i></div>
                    <div class="ms-3">
                        <h6 class="fw-semibold mb-1">Phone Number</h6>
                        <h5 class="mb-0">{{ user.phone }}</h5>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-12">
            <div class="card stats-card stats-card-4 h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="stats-icon bg-info-subtle text-info"><i class="bi bi-shield-check"></i></div>
                    <div class="ms-3">
                        <h6 class="fw-semibold mb-1">Account Status</h6>
                        <span class="badge {% if user.frozen %}bg-danger{% else %}bg-success{% endif %} px-3 py-2">
                            {% if user.frozen %}Frozen{% else %}Active{% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Account Details -->
    <div class="row justify-content-center">
        <div class="col-lg-4 col-md-6 col-sm-10">
            <div class="card account-details-card shadow-sm">

                <div class="card-header bg-white border-bottom">
                    <h5 class="fw-semibold mb-0"><i class="bi bi-person me-2"></i>Account Information</h5>
                </div>

                <div class="card-body">

                    <!-- Manual Info Items (no loop, no errors) -->
                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-person"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">Customer Name</div>
                            <div class="info-value fw-semibold">{{ user.name }}</div>
                        </div>
                    </div>

                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-telephone"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">Phone</div>
                            <div class="info-value fw-semibold">{{ user.phone }}</div>
                        </div>
                    </div>

                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-shop"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">Shop Name</div>
                            <div class="info-value fw-semibold">{{ user.shop_name|default:"Not specified" }}</div>
                        </div>
                    </div>

                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-credit-card"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">Retailer ID</div>
                            <div class="info-value fw-semibold">{{ user.retailer_id|default:"Not assigned" }}</div>
                        </div>
                    </div>

                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-geo-alt"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">Location</div>
                            <div class="info-value fw-semibold">
                                {% if user.area %}{{ user.area }}, {% endif %}
                                {{ user.city|default:"City not specified" }}
                            </div>
                        </div>
                    </div>

                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-envelope"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">Pin Code</div>
                            <div class="info-value fw-semibold">{{ user.pin_code|default:"Not specified" }}</div>
                        </div>
                    </div>

                    <div class="info-item d-flex mb-3">
                        <div class="info-icon"><i class="bi bi-flag"></i></div>
                        <div class="ms-3">
                            <div class="info-title text-muted small">State</div>
                            <div class="info-value fw-semibold">{{ user.state|default:"Not specified" }}</div>
                        </div>
                    </div>

                    <div class="text-end mt-3">
                        <a href="{% url 'customer_portal:update_profile' %}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil-square me-1"></i>Update Profile
                        </a>
                    </div>

                </div>

            </div>
        </div>
    </div>

</div>
{% endblock %}
